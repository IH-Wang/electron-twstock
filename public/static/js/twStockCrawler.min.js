"use strict";var e,t=(e=require("headless-chrome-crawler"))&&"object"==typeof e&&"default"in e?e.default:e;const a=async(e,a)=>new Promise((async(s,r)=>{const n=await t.launch({evaluatePage:a,onSuccess:e=>{s(e.result)},onError:e=>{console.log(e),r([])}});await n.queue(e),await n.onIdle(),await n.close()})),s=()=>{const e=[],t=$("tbody tr"),a=(e,t)=>e.eq(t).text().trim();return t.map((s=>{const r=t.eq(s).find("td");if(7===r.length){const t=a(r,0).split(/(\d+)/).filter((e=>e));4===t[0].length&&e.push({code:t[0],name:t[1].trim(),marketType:a(r,3),category:a(r,4)})}})),e},r=()=>{const e=$("pre").text().replace(";","").split(" ").map((e=>e.split(","))),t=1,a=2,s=3,r=4,n=5,i=6,o=7,l=8,c=9,p=10,d=14,u=15,m=16,g=17,w=18,h=19,I=20,y=21,b=22;return e[0].map(((f,P)=>({date:f,startPrice:parseFloat(e[t][P]),maxPrice:parseFloat(e[a][P]),minPrice:parseFloat(e[s][P]),endPrice:parseFloat(e[r][P]),vol:parseInt(e[n][P],10),marginPurchase:parseInt(e[i][P],10),shortSale:parseInt(e[o][P],10),foreignHolding:parseInt(e[l][P],10),sitesHolding:parseInt(e[c][P],10),dealerHolding:parseInt(e[p][P],10),bigThreeHolding:parseInt(e[d][P],10),majorNetBuySell:parseInt(e[u][P],10),dayTrading:parseInt(e[m][P],10),marginPurchaseRatio:parseFloat(e[g][P]),bsmRatio:parseFloat(e[w][P]),foreignNetBuySell:parseInt(e[h][P],10),sitesNetBuySell:parseInt(e[I][P],10),dealerNetBuySell:parseInt(e[y][P],10),bigThreeNetBuySell:parseInt(e[b][P],10)})))},n={getStockCode:async()=>{const[e,t,r]=await Promise.all([await a("https://isin.twse.com.tw/isin/C_public.jsp?strMode=2",s),await a("https://isin.twse.com.tw/isin/C_public.jsp?strMode=4",s),await a("https://isin.twse.com.tw/isin/C_public.jsp?strMode=5",s)]);return[...e,...t,...r].filter((e=>-1===e.name.indexOf("ã€€")))},getStockInfo:async(e,t)=>{const s=`https://fubon-ebrokerdj.fbs.com.tw/Z/ZC/ZCW/CZKC1.djbcd?a=${e}&b=D&c=${t}`;return await a(s,r)}};module.exports=n;
